---
title: "Confounds"
citeproc: true
bibliography: ../../static/bib/references.bib
csl: ../../static/bib/chicago-fullnote-bibliography-no-bib.csl
menu: 
  class:
    parent: Class
    weight: 7
type: docs
output:
  blogdown::html_page:
    toc: true
editor_options: 
  chunk_output_type: console
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#the-experimental-gold-standard">The experimental gold standard</a></li>
<li><a href="#marriage-divorce-age-and-confounding">Marriage, divorce, age, and confounding</a></li>
<li><a href="#elemental-confounds">Elemental confounds</a>
<ul>
<li><a href="#forks">forks</a></li>
<li><a href="#pipes">pipes</a></li>
<li><a href="#collider">collider</a></li>
</ul></li>
</ul>
</div>

<div id="the-experimental-gold-standard" class="section level2">
<h2>The experimental gold standard</h2>
<p>Remember that in an experiment, we randomize assignment to some treatment, measure an outcome we care about, and compare whether the units that got the treatment have better or worse results on the outcome than the group that didn’t get the treatment.</p>
<p>We can simulate a fake experiment (on rats) using R:</p>
<pre class="r"><code>library(tidyverse)
library(broom)

rats = tibble(rat_id = 1:200, 
              vaccine = sample(c(1, 0), size = 200, 
                               replace = TRUE)) %&gt;% 
  mutate(covid_levels = -2*vaccine + rnorm(200))

rats</code></pre>
<pre><code>## # A tibble: 200 x 3
##    rat_id vaccine covid_levels
##     &lt;int&gt;   &lt;dbl&gt;        &lt;dbl&gt;
##  1      1       1       -1.65 
##  2      2       0        0.830
##  3      3       1       -1.91 
##  4      4       1       -1.92 
##  5      5       1       -2.53 
##  6      6       1       -2.79 
##  7      7       1       -2.46 
##  8      8       0       -0.738
##  9      9       1       -2.25 
## 10     10       1       -0.671
## # … with 190 more rows</code></pre>
<p>Note that in making up our data, we decided that the vaccine would have an effect of -2 on covid_levels.</p>
<p>We can estimate the effect of the vaccine on COVID using regression:</p>
<pre class="r"><code># estimate treatment effect
m1 = lm(covid_levels ~ vaccine, data = rats)
tidy(m1)</code></pre>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept) -0.00180    0.0856   -0.0210 9.83e- 1
## 2 vaccine     -2.04       0.122   -16.8    6.72e-40</code></pre>
</div>
<div id="marriage-divorce-age-and-confounding" class="section level2">
<h2>Marriage, divorce, age, and confounding</h2>
<p>Remember in class that we can have a DAG like the below, where the age (A) at which people get married has a negative causal effect on the marriage (M) rate (places where people wait till later to get married have lower marriage rates) and a negative causal effect on the divorce (D) rate (places where people wait to get married have lower divorce rates).</p>
<pre class="r"><code>library(ggdag)

dagify(D ~ A, 
       M ~ A) %&gt;% 
  ggdag(layout = &quot;circle&quot;) + 
  theme_dag()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Note that there is no arrow from marriage rate (M) to divorce (D). We have explicitly made our data so that there is no causal effect of M on D. And yet! this DAG will produce data that shows a strong relationship between M and D.</p>
<p>Faking some data helps us see this:</p>
<pre class="r"><code>fake = tibble(age = rnorm(100), 
       marriage = -2*age + rnorm(100), 
       divorce = -2*age + rnorm(100))

ggplot(fake, aes(x = marriage, y = divorce)) + 
  geom_point() + geom_smooth(method = &quot;lm&quot;) + 
  theme_light()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Note the line of code defining the divorce rate: no marriage there!</p>
</div>
<div id="elemental-confounds" class="section level2">
<h2>Elemental confounds</h2>
<div id="forks" class="section level3">
<h3>forks</h3>
<p>Remember, the fork looks like this:</p>
<pre class="r"><code>confounder_triangle(x = &quot;Has Huge beard&quot;, 
                    y = &quot;Amount of basketball watched&quot;,
                    z = &quot;Love James Harden&quot;) %&gt;% 
  ggdag(use_labels = &quot;label&quot;) +
  theme_dag()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Or like this:</p>
<pre class="r"><code>confounder_triangle(x = &quot;Marriage rate&quot;, 
                    y = &quot;Divorce rate&quot;,
                    z = &quot;Median age at marriage&quot;, x_y_associated = TRUE) %&gt;% 
  ggdag(use_labels = &quot;label&quot;) +
  theme_dag()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="pipes" class="section level3">
<h3>pipes</h3>
<p>The pipe looks like this:</p>
<pre class="r"><code>dagify(Y ~ B + G, 
       B ~ X, 
       labels = c(&quot;Y&quot; = &quot;Plant growth&quot;, 
                  &quot;B&quot; = &quot;Good bacteria&quot;, 
                  &quot;G&quot; = &quot;Starting size&quot;, 
                  &quot;X&quot; = &quot;Fertilizer&quot;)) %&gt;% 
  ggdag(use_labels = &quot;label&quot;) + 
  theme_dag_blank()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="collider" class="section level3">
<h3>collider</h3>
<p>The collider looks like this:</p>
<pre class="r"><code>collider_triangle(x = &quot;Qualtiy research&quot;, 
                  y = &quot;Surprising results&quot;, 
                  m = &quot;Published&quot;) %&gt;% 
  ggdag(use_labels = &quot;label&quot;) + 
  theme_dag_blank()</code></pre>
<p><img src="/class/confounds_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
</div>
